{% extends "base.html" %}
{% load static %}
{% block title %}{{ it.titulo }} - Fuego de Atenea{% endblock %}

{% block content %}
<div class="product-detail-container" style="max-width:1000px;margin:0 auto;padding:20px 0;">
  
  <!-- Breadcrumb Navigation -->
  <nav style="margin-bottom:24px;font-size:14px;color:#6b7280;">
    <a href="{% url 'sahumerios_lista' %}" style="color:#111827;text-decoration:none;font-weight:500;">üè† Cat√°logo</a>
    <span style="margin:0 8px;">‚Ä∫</span>
    <span style="color:#6b7280;">{{ it.titulo }}</span>
  </nav>

  <div class="product-detail-card" style="background:white;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.08);overflow:hidden;">
    <div class="product-detail-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:40px;padding:40px;">
      
      <!-- Columna Imagen -->
      <div class="product-image-section">
        <div class="product-image-container" style="border-radius:12px;overflow:hidden;background:#f8f9fa;position:relative;">
          {% if it.img_file %}
            <img src="{% static 'img/productos/' %}{{ it.img_file }}" 
                 alt="{{ it.titulo }}" 
                 style="width:100%;height:400px;object-fit:cover;border-radius:12px;">
          {% elif it.img_abs %}
            <img src="{{ it.img_abs }}" 
                 alt="{{ it.titulo }}" 
                 style="width:100%;height:400px;object-fit:cover;border-radius:12px;">
          {% else %}
            <img src="{% static 'img/placeholder.png' %}" 
                 alt="{{ it.titulo }}" 
                 style="width:100%;height:400px;object-fit:cover;border-radius:12px;padding:40px;background:#f8f9fa;">
          {% endif %}
        </div>
      </div>

      <!-- Columna Informaci√≥n -->
      <div class="product-info-section">
        <div style="margin-bottom:16px;">
          <span style="background:#e0f2fe;color:#0369a1;padding:4px 12px;border-radius:20px;font-size:12px;font-weight:600;text-transform:uppercase;">
            {% if match_id %}Producto Disponible{% else %}Importado{% endif %}
          </span>
        </div>

        <h1 style="font-size:2rem;font-weight:700;color:#111827;margin:0 0 12px 0;line-height:1.2;">
          {{ it.titulo }}
        </h1>

        {% if it.marca %}
        <div style="margin-bottom:16px;">
          <span style="font-weight:600;color:#374151;">Marca:</span>
          <span style="color:#6b7280;margin-left:8px;">{{ it.marca }}</span>
        </div>
        {% endif %}

        {% if it.descripcion %}
        <div style="margin-bottom:24px;padding:16px;background:#f8f9fa;border-radius:8px;">
          <p style="margin:0;color:#4b5563;line-height:1.6;">{{ it.descripcion }}</p>
        </div>
        {% endif %}

        <!-- Precio -->
        <div style="margin-bottom:24px;">
          <div style="font-size:2.5rem;font-weight:700;color:#111827;margin:0;">
            ${{ it.precio }}
          </div>
          {% if not match_id %}
          <div style="color:#6b7280;font-size:14px;margin-top:4px;">
            Precio especial de importaci√≥n
          </div>
          {% endif %}
        </div>

        <!-- Formulario Agregar al Carrito -->
        <div class="add-to-cart-section" style="margin-bottom:24px;">
          {% if match_id %}
            <!-- ‚úÖ Producto vinculado a DB -->
            <form action="{% url 'cart:add_db' match_id %}" method="post" class="cart-form" data-cart-form>
              {% csrf_token %}
              <div style="display:flex;gap:12px;align-items:center;margin-bottom:12px;">
                <label style="font-weight:600;color:#374151;">Cantidad:</label>
                <div style="display:flex;align-items:center;gap:8px;">
                  <button type="button" class="qty-minus" style="width:36px;height:36px;border:1px solid #d1d5db;background:white;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;">‚àí</button>
                  <input type="number" name="quantity" value="1" min="1" style="width:70px;padding:8px;border:1px solid #d1d5db;border-radius:8px;text-align:center;font-weight:600;">
                  <button type="button" class="qty-plus" style="width:36px;height:36px;border:1px solid #d1d5db;background:white;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;">+</button>
                </div>
              </div>
              <input type="hidden" name="replace" value="0">
              <button type="submit" class="btn" style="background:#10b981;color:white;border:none;padding:12px 24px;border-radius:10px;font-weight:600;cursor:pointer;width:100%;font-size:16px;">
                üõí Agregar al Carrito
              </button>
            </form>
            <div style="margin-top:8px;text-align:center;">
              <span style="color:#059669;font-size:14px;">‚úÖ Producto disponible en stock</span>
            </div>

          {% else %}
            <!-- üîÑ Producto de Excel (sin vincular) - AHORA S√ç PUEDE AGREGARSE -->
            <form action="{% url 'cart:add' %}" method="post" class="cart-form" data-cart-form>
              {% csrf_token %}
              <input type="hidden" name="origin" value="X">
              <input type="hidden" name="product_id" value="{{ it.idx }}">
              <input type="hidden" name="name" value="{{ it.titulo }}">
              <input type="hidden" name="price" value="{{ it.precio }}">
              <input type="hidden" name="img" value="{% if it.img_abs %}{{ it.img_abs }}{% elif it.img_file %}{% static 'img/productos/' %}{{ it.img_file }}{% else %}{% static 'img/placeholder.png' %}{% endif %}">
              <input type="hidden" name="replace" value="0">
              
              <div style="display:flex;gap:12px;align-items:center;margin-bottom:12px;">
                <label style="font-weight:600;color:#374151;">Cantidad:</label>
                <div style="display:flex;align-items:center;gap:8px;">
                  <button type="button" class="qty-minus" style="width:36px;height:36px;border:1px solid #d1d5db;background:white;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;">‚àí</button>
                  <input type="number" name="quantity" value="1" min="1" style="width:70px;padding:8px;border:1px solid #d1d5db;border-radius:8px;text-align:center;font-weight:600;">
                  <button type="button" class="qty-plus" style="width:36px;height:36px;border:1px solid #d1d5db;background:white;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;">+</button>
                </div>
              </div>
              
              <button type="submit" class="btn" style="background:#f59e0b;color:white;border:none;padding:12px 24px;border-radius:10px;font-weight:600;cursor:pointer;width:100%;font-size:16px;">
                üõí Agregar al Carrito
              </button>
            </form>
            <div style="margin-top:8px;text-align:center;">
              <span style="color:#d97706;font-size:14px;">üì¶ Producto de importaci√≥n - Entrega especial</span>
            </div>
          {% endif %}
        </div>

        <!-- Botones de Acci√≥n -->
        <div style="display:flex;gap:12px;margin-top:24px;">
          <a href="{% url 'sahumerios_lista' %}" 
             style="flex:1;padding:12px 20px;border:1px solid #d1d5db;border-radius:10px;text-align:center;color:#374151;text-decoration:none;font-weight:600;background:white;">
            ‚Ü©Ô∏è Volver al Cat√°logo
          </a>
          <a href="{% url 'cart:detail' %}" 
             style="flex:1;padding:12px 20px;border:1px solid #111827;border-radius:10px;text-align:center;color:white;text-decoration:none;font-weight:600;background:#111827;">
            üõí Ver Carrito
          </a>
        </div>

        <!-- Informaci√≥n Adicional para productos Excel -->
        {% if not match_id %}
        <div style="margin-top:24px;padding:16px;background:#fffbeb;border:1px solid #fcd34d;border-radius:8px;">
          <div style="display:flex;align-items:flex-start;gap:12px;">
            <div style="font-size:18px;">üí°</div>
            <div>
              <p style="margin:0 0 8px 0;font-weight:600;color:#92400e;">Producto de Cat√°logo Importado</p>
              <p style="margin:0;color:#92400e;font-size:14px;line-height:1.4;">
                Este producto est√° disponible mediante nuestro sistema de importaci√≥n. 
                Agr√©galo al carrito y coordinaremos la disponibilidad contigo.
              </p>
            </div>
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Control de cantidad +/-
  document.querySelectorAll('.cart-form').forEach(form => {
    const minusBtn = form.querySelector('.qty-minus');
    const plusBtn = form.querySelector('.qty-plus');
    const quantityInput = form.querySelector('input[name="quantity"]');
    
    if (minusBtn && plusBtn && quantityInput) {
      minusBtn.addEventListener('click', function() {
        const currentValue = parseInt(quantityInput.value) || 1;
        quantityInput.value = Math.max(1, currentValue - 1);
      });
      
      plusBtn.addEventListener('click', function() {
        const currentValue = parseInt(quantityInput.value) || 1;
        quantityInput.value = currentValue + 1;
      });
    }
  });
  
  // Actualizar carrito despu√©s de agregar productos
  document.querySelectorAll('form[data-cart-form]').forEach(form => {
    form.addEventListener('submit', function() {
      // Disparar evento para actualizar el carrito
      setTimeout(() => {
        document.dispatchEvent(new CustomEvent('cartUpdated'));
      }, 800);
    });
  });
});
</script>

<style>
@media (max-width: 768px) {
  .product-detail-grid {
    grid-template-columns: 1fr !important;
    gap: 20px !important;
    padding: 20px !important;
  }
  
  .product-image-container img {
    height: 300px !important;
  }
  
  .product-detail-container {
    padding: 10px !important;
  }
}

.qty-minus:hover, .qty-plus:hover {
  background: #f3f4f6 !important;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
</style>
{% endblock %}